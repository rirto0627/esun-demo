## 🌿 分支說明：`RESTful-API-Design`

---

### 📦 專案分層架構

| 層級    | 類別                                                                                                          |
| ----- | ----------------------------------------------------------------------------------------------------------- |
| 展示層   | `LikeListController`, `SpaController`                                                                       |
| 業務邏輯層 | `LikeListService`, `LikeListServiceImpl`                                                                    |
| 資料存取層 | `LikeListRepository`                                                                                        |
| 共用層   | `LikeListRequest`, `ApiResponse`、例外類別如 `BadRequestException`, `NotFoundException`, `GlobalExceptionHandler` |

---

### 🧠 觀念釐清

* **Controller**：接收前端請求、處理路由與資料驗證。
* **Service**：封裝商業邏輯，控制流程、轉換與存取資料。
* **DTO（Data Transfer Object）**：用於請求與回應的資料傳輸格式。
* **Impl（Implementation）**：`Service` 接口的具體實作。
* **Stored Procedure**：定義在資料庫中，可重複使用的 SQL 邏輯。

---

### 📘 學習重點

* ✅ 使用 **Lombok** 簡化資料類別撰寫。
* ✅ 透過 **Stored Procedure** 提高資料操作效率與一致性。
* ✅ 建立統一的錯誤處理機制 `GlobalExceptionHandler`。
* ✅ 使用 `@Transactional` 管理資料庫交易，確保原子性。
* ✅ 撰寫單元測試（JUnit5 + MockMvc），覆蓋所有 API 行為。
* ✅ 分層架構設計清晰，有助於日後維護與模組擴充。

---

### 🐛 開發過程中遇到的問題與解法

#### ✅ 1. Controller 回傳格式不一致

* **問題**：成功與錯誤回傳格式不統一，難以解析。
* **解法**：統一使用 `ApiResponse<T>` 回傳結構，並包裝於 `ResponseEntity`。

---

#### ✅ 2. 拋出錯誤但仍回傳 200

* **問題**：拋出自訂例外（如 `BadRequestException`）仍返回 HTTP 200。
* **解法**：實作 `@RestControllerAdvice` 並於其中指定正確的 HTTP 狀態碼。

---

#### ✅ 3. 驗證失敗回傳內容過長不清楚

* **問題**：`@Valid` 驗證錯誤時訊息不友善。
* **解法**：在 `GlobalExceptionHandler` 攔截 `MethodArgumentNotValidException`，統一回傳「請求資料缺漏或格式錯誤」。

---

#### ✅ 4. 刪除不存在資料仍顯示成功

* **問題**：即使 SN 不存在，仍顯示「刪除成功」。
* **解法**：透過 `CallableStatement.executeUpdate()` 回傳值檢查刪除筆數為 0 時丟出 `NotFoundException`。

---

#### ✅ 5. 驗證錯誤未對應 HTTP 400

* **問題**：欄位驗證失敗時回傳 500 而非 400。
* **解法**：在全域例外處理中加入 `@ExceptionHandler(MethodArgumentNotValidException.class)`，並設為 400 回應。